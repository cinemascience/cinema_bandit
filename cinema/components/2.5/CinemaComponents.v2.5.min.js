"use strict";(function(){var e={};window.CINEMA_COMPONENTS?e=window.CINEMA_COMPONENTS:window.CINEMA_COMPONENTS=e,e.DATABASE_INCLUDED=!0,e.DIMENSION_TYPE=Object.freeze({INTEGER:0,FLOAT:1,STRING:2}),e.Database=function(e,a,o){this.directory=e,this.loaded=!1,this.error,this.data=[],this.dimensions=[],this.dimensionTypes={},this.dimensionDomains={},this.hasAxisOrdering=!1,this.axisOrderData,this.dispatch=d3.dispatch("dataUpdated"),this.errorCallback=o;var s=this;s.path=e+"/data.csv",i(s.path,function(l,c){return s.prevContentLength=c.getResponseHeader("Content-Length"),s.error=r(l),s.error?(console.warn(s.error),void(o&&o())):void(t(s,l),i(e+"/axis_order.csv",function(e){var t=d(e,s.dimensions);t?console.warn("ERROR in axis_order.csv: "+t):(s.hasAxisOrdering=!0,s.axisOrderData=n(e)),s.loaded=!0,a&&a(s)},function(){s.loaded=!0,a&&a(s)}))},function(){o&&o("Error loading data.csv!")})},e.Database.prototype.isStringDimension=function(t){return this.dimensionTypes[t]===e.DIMENSION_TYPE.STRING};var t=function(t,a){t.dimensions=a[0],t.data=a.slice(1).map(function(e){var a={};return t.dimensions.forEach(function(t,n){a[t]=e[n]}),a}),t.dimensions.forEach(function(a){for(var n=t.data[0][a],o=0;n===void 0&&o<t.data.length;)n=t.data[++o];if(!isNaN(n)||"NAN"===n.toUpperCase()){t.dimensionTypes[a]=isNaN(n)||!Number.isInteger(n)?e.DIMENSION_TYPE.FLOAT:e.DIMENSION_TYPE.INTEGER;var o;for(o=0;o<t.data.length&&isNaN(t.data[o][a]);o++);if(o==t.data.length)t.dimensionDomains[a]=[0,0];else{for(var s=t.data[o][a],r=t.data[o][a],d=o;d<t.data.length;d++)isNaN(t.data[d][a])||(s=Math.min(s,t.data[d][a]),r=Math.max(r,t.data[d][a]));t.dimensionDomains[a]=[s,r]}}else t.dimensionTypes[a]=e.DIMENSION_TYPE.STRING,t.dimensionDomains[a]=t.data.map(function(e){return e[a]})})};e.Database.prototype.refreshData=function(e){var t=this;if(e)i(t.path,function(e,n){a(t,e,n)},t.errorCallback);else{var n=new XMLHttpRequest;n.open("HEAD",t.path,!0),n.onreadystatechange=function(){if(4===n.readyState&&(200===n.status||navigator.userAgent.match(/Safari/)&&0===n.status)){var e=n.getResponseHeader("Content-Length");e!=t.prevContentLength&&i(t.path,function(e,n){a(t,e,n)},t.errorCallback)}},n.send(null)}};var a=function(e,a,n){if(a[0].length!=e.dimensions.length)return void console.warn("Updates to data cannot change the number of dimensions!");for(var o in e.dimensions)if(e.dimensions[o]!=a[0][o])return void console.warn("Updates to data cannot change the names of dimensions!");var i=r(a);if(i)return void console.warn("Error in updated data!\n"+i);e.prevContentLength=n.getResponseHeader("Content-Length");for(var s=a.slice(1).map(function(t){var a={};return e.dimensions.forEach(function(e,n){a[e]=t[n]}),a}),d=!1,l={added:[],modified:[],removed:[],oldData:e.data,oldDimensionDomains:e.dimensionDomains},c=0;c<e.data.length||c<s.length;c++)c>=e.data.length?(l.added.push(c),d=!0):c>=s.length?(l.removed.push(c),d=!0):JSON.stringify(e.data[c])!==JSON.stringify(s[c])&&(l.modified.push(c),d=!0);d&&(e.data=s,e.dimensionDomains={},t(e,a),e.dispatch.call("dataUpdated",e,l))};e.Database.prototype.getSimilar=function(e,t){var a=this,n=[];return this.data.forEach(function(i,s){var r=0;a.dimensions.forEach(function(t){if(void 0!==e[t])if(a.isStringDimension(t))r+=i[t]==e[t]?0:1;else if(isNaN(e[t]))r+=isNaN(i[t])?0:1;else if(void 0===i[t])r+=1;else{var n=a.dimensionDomains[t];r+=Math.abs(o(e[t],n[0],n[1])-o(i[t],n[0],n[1]))}}),r<=t&&n.push(s)}),n};var n=function(e){var t={};return e.slice(1).forEach(function(a){var n=a[0];t[n]||(t[n]=[]);var i=a[1];t[n].push({name:i});var o=e[0].slice(2).map(function(e,t){return[a[t+2],t]}).sort(function(e,t){return void 0===e[0]?1:void 0===t[0]?-1:e[0]-t[0]}).map(function(t){return e[0].slice(2)[t[1]]});t[n][t[n].length-1].order=o}),t},i=function(e,t,a){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status||navigator.userAgent.match(/Safari/)&&0===n.status){var e=s(n.responseText);t&&t(e,n)}else a&&a()},n.send(null)},o=function(e,t,a){return 0==a-t?0:(e-t)/(a-t)},s=function(e){var t,a=/(\,|\r?\n|\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^\,\r\n]*))/gi,n=[];if(""===e)return n;for(;t=a.exec(e);){var i=t[1],o=t[2],s=t[3];","!=i&&n.push([]),void 0===o?n[n.length-1].push(""===s?void 0:s.replace(/""/g,"\"")):n[n.length-1].push(o.replace(/""/g,"\""))}return 1<n.length&&1==n[n.length-1].length&&void 0===n[n.length-1][0]&&(n=n.slice(0,n.length-1)),n},r=function(e){if(2>e.length)return"The first and second lines in the file are required.";if(2>e[0].length)return"The dataset must include at least two dimensions";var t=!1;for(var a in e[0])t=t||e[0][a]===void 0;if(t)return"Empty values may not occur in the header (first line).";var n=e[0].length;for(var a in e)if(e[a].length!=n)return"Each line must have an equal number of comma separated values (columns).";for(var o,a=0;a<e[0].length;a++){o=!0;for(var s=0;s<e.length;s++)o=o&&e[s][a]===void 0;if(o)return"There cannot be any columns with all undefined values."}},d=function(e,t){if(2>e.length)return"The first and second lines in the file are required.";var a=e[0].length;for(var n in e)if(e[n].length!=a)return"Each line must have an equal number of comma separated values (columns).";for(var n=2;n<e[0].length;n++)if(!t.includes(e[0][n]))return"Dimension in axis order file '"+e[0][n]+"' is not valid";for(var n=0;n<e.length;n++){if(e[n][0]===void 0)return"Category cannot be undefined.";if(void 0===e[n][1])return"Value cannot be undefined."}for(var n=1;n<e.length;n++)for(var o=2;o<e[n].length;o++)if(isNaN(e[n][o])&&e[n][o]!==void 0)return"Values for dimensions cannot be NaN."}})(),"use strict",function(){var e={};if(window.CINEMA_COMPONENTS?e=window.CINEMA_COMPONENTS:window.CINEMA_COMPONENTS=e,!e.DATABASE_INCLUDED)throw new Error("CINEMA_COMPONENTS Component module requires that Database module be included. Please make sure that Database module is included BEFORE Component module");e.COMPONENT_INCLUDED=!0,e.Component=function(t,a,n){if(this.constructor===e.Component)throw new Error("Cannot instantiate abstract class 'Component.' Please use a subclass.");this.parent=t,this.parent.innerHTML="",this.db=a,this.dimensions=[],this.filter=n,this.dimensions=this.db.dimensions.filter(function(e){return!n||!n.test(e)}),this.container=t.appendChild(document.createElement("div")),this.container.setAttribute("class","CINEMA_COMPONENT"),this.container.style.position="absolute",e.Component.prototype.updateSize.call(this)},e.Component.prototype.updateSize=function(){this.margin=this.margin||new e.Margin(0,0,0,0),this.parentRect=this.parent.getBoundingClientRect(),this.internalWidth=this.parentRect.width-this.margin.left-this.margin.right,this.internalHeight=this.parentRect.height-this.margin.top-this.margin.bottom,this.container.style.width=this.parentRect.width+"px",this.container.style.height=this.parentRect.height+"px"},e.Component.prototype.destroy=function(){d3.select(this.container).remove()},e.Margin=function(e,t,a,n){this.top=e,this.right=t,this.bottom=a,this.left=n},e.ExtraData=function(e,t){this.data=e,this.style=t}}(),"use strict",function(){var e=Math.PI,t=Math.min,a={};if(window.CINEMA_COMPONENTS?a=window.CINEMA_COMPONENTS:window.CINEMA_COMPONENTS=a,!a.COMPONENT_INCLUDED)throw new Error("CINEMA_COMPONENTS Glyph module requires that Component module be included. Please make sure that Component module is included BEFORE Glyph module");if(!window.d3)throw new Error("CINEMA_COMPONENTS Glyph module requires that d3 be included (at least d3v4). Please make sure that d3 is included BEFORE the the Glyph module");a.GLYPH_INCLUDED=!0;a.Glyph=function(n,i,o){var s=this;this.margin=new a.Margin(50,50,50,50),this.innerMargin,this.radius,a.Component.call(this,n,i,o),this.radius=t(this.internalHeight,this.internalWidth)/2,this.innerMargin=this.radius/11,this.selected=0,this.rotation=d3.scalePoint().domain(this.dimensions).range([0,2*e-2*e/(this.dimensions.length+1)]),this.scales={},this.dimensions.forEach(function(e){s.scales[e]=s.db.isStringDimension(e)?d3.scalePoint().domain(s.db.dimensionDomains[e]).range([s.radius-s.innerMargin,0]):d3.scaleLinear().domain(s.db.dimensionDomains[e]).range([s.radius-s.innerMargin,0])}),d3.select(this.container).classed("GLYPH",!0),this.svg=d3.select(this.container).append("svg").attr("class","glyphChart").attr("viewBox",-this.margin.right+" "+-this.margin.top+" "+this.parentRect.width+" "+this.parentRect.height).attr("preserveAspectRatio","none").attr("width","100%").attr("height","100%"),this.path=this.svg.append("path").classed("glyph",!0),this.labels=s.svg.append("g").classed("labels",!0).selectAll("g.label").data(this.dimensions).enter().append("g").classed("label",!0).attr("transform",function(e){return s.getAxisTransform(e)}),this.labels.append("text").style("text-anchor","middle").text(function(e){return e}).attr("transform",function(e){return"translate(0 -15) rotate("+s.getTextRotation(e)+")"}),this.axisContainer=this.svg.append("g").classed("axisContainer",!0),this.axes=this.axisContainer.selectAll(".axisGroup").data(this.dimensions).enter().append("g").classed("axisGroup",!0).attr("transform",function(e){return s.getAxisTransform(e)}),this.axes.append("g").classed("axis",!0).each(function(e){d3.select(this).call(d3.axisLeft().scale(s.scales[e])),d3.select(this).selectAll("text").style("text-anchor","end").attr("transform","rotate("+s.getTextRotation(e)+" -15 0)")}),this.redraw()},a.Glyph.prototype=Object.create(a.Component.prototype),a.Glyph.prototype.constructor=a.Glyph,a.Glyph.prototype.getPath=function(e){var t,a,n=this;return this.dimensions.forEach(function(o,s){var i=n.getPoint(o,e);0==s?(a=i,t="M "+i.x+" "+i.y+" "):s==n.dimensions.length-1?t+="L "+i.x+" "+i.y+" L "+a.x+" "+a.y:t+="L "+i.x+" "+i.y+" "}),t},a.Glyph.prototype.getPoint=function(t,a){if(isNaN(a[t]))return{x:this.radius,y:this.radius};var n=this.radius-this.scales[t](a[t]),i=this.rotation(t)-e/2,o=Math.cos(i)*n,s=Math.sin(i)*n;return{x:o+this.radius,y:s+this.radius}},a.Glyph.prototype.updateSize=function(){var e=this;a.Component.prototype.updateSize.call(this),this.radius=t(this.internalHeight,this.internalWidth)/2,this.innerMargin=this.radius/11,this.svg.attr("viewBox",-this.margin.right+" "+-this.margin.top+" "+this.parentRect.width+" "+this.parentRect.height),this.dimensions.forEach(function(t){e.scales[t].range([e.radius-e.innerMargin,0])}),this.axes.attr("transform",function(t){return e.getAxisTransform(t)}).each(function(t){d3.select(this).select(".axis").call(d3.axisLeft().scale(e.scales[t]))}),this.labels.attr("transform",function(t){return e.getAxisTransform(t)}),this.path.attr("d",function(t){return e.getPath(e.db.data[t])})},a.Glyph.prototype.updateData=function(){var e=this;this.dimensions.forEach(function(t){e.scales[t].domain(e.db.dimensionDomains[t])}),this.axes.each(function(t){d3.select(this).select(".axis").call(d3.axisLeft().scale(e.scales[t]))}),this.redraw()},a.Glyph.prototype.setSelected=function(e){this.selected=e,this.redraw()},a.Glyph.prototype.redraw=function(){var e=this;this.path.datum(this.selected).transition(1e3).attr("d",function(t){return e.getPath(e.db.data[t])})},a.Glyph.prototype.getAxisTransform=function(t){var a=this.radius,n=this.rotation(t)*(180/e);return"translate("+a+") rotate("+n+" 0 "+a+")"},a.Glyph.prototype.getTextRotation=function(t){var a=this.rotation(t)*(180/e);return 90<a&&270>a?180:0}}(),"use strict",function(){function e(e,t){if(7>=e){for(var a=[],n=0;n<e;n++)a.push({text:n+1,page:n+1,do_rebuild:!1});return a}var o=Math.pow(10,Math.round(Math.log10(e)-1)),a=[];if(1!=t){a.push({text:"|<",page:1,do_rebuild:!0}),a.push({text:"<",page:t-1,do_rebuild:!0});var s=1<=t-o?t-o:t-1;a.push({text:s,page:s,do_rebuild:!0})}if(a.push({text:t,page:t,do_rebuild:!1}),t!=e){var r=t+o<=e?t+o:t+1;a.push({text:r,page:r,do_rebuild:!0}),a.push({text:">",page:t+1,do_rebuild:!0}),a.push({text:">|",page:e,do_rebuild:!0})}return a}function t(e){if(!e)return!1;e=e.trimLeft().trimRight();var t=["JPG","JPEG","PNG","GIF","VTI","PDB"].indexOf(e.toUpperCase());return 0<=t}function a(e){return e?e.substr(e.lastIndexOf(".")+1).trimRight():void 0}var n={};if(window.CINEMA_COMPONENTS?n=window.CINEMA_COMPONENTS:window.CINEMA_COMPONENTS=n,!n.COMPONENT_INCLUDED)throw new Error("CINEMA_COMPONENTS ImageSpread module requires that Component module be included. Please make sure that Component module is included BEFORE ImageSpread module");if(!window.d3)throw new Error("CINEMA_COMPONENTS ImageSpread module requires that d3 be included (at least d3v4). Please make sure that d3 is included BEFORE the the ImageSpread module");n.IMAGE_SPREAD_INCLUDED=!0,n.ImageSpread=function(e,t){var a=this;return n.Component.call(this,e,t),this.dimensions=this.dimensions.filter(function(e){return /^FILE/.test(e)}),this.hasFileDimensions=0!=this.dimensions.length,this.selection=[],this.currentPage=1,this.dispatch=d3.dispatch("mouseover"),d3.select(this.container).classed("IMAGE_SPREAD",!0),this.hasFileDimensions?void(this.header=d3.select(this.container).append("div").classed("header",!0).style("position","absolute").style("width","100%"),this.imageContainer=d3.select(this.container).append("div").classed("imageContainer",!0).style("position","absolute").style("width","100%").style("overflow-y","auto"),this.pageSizeContainer=this.header.append("div").classed("controlPanel pageSize",!0),this.pageSizeContainer.append("span").classed("label",!0).text("Results Per Page:"),this.pageSizeContainer.append("br"),this.pageSizeNode=this.pageSizeContainer.append("select").on("change",function(){a.updatePageNav(),a.populateResults()}).node(),d3.select(this.pageSizeNode).selectAll("option").data([10,25,50,100]).enter().append("option").attr("value",function(e){return e}).text(function(e){return e}),d3.select(this.pageSizeNode).select("option[value=\"25\"]").attr("selected","true"),this.sortContainer=this.header.append("div").classed("controlPanel sort",!0),this.sortContainer.append("span").classed("label",!0).text("Sort By:"),this.sortContainer.append("br"),this.sortNode=this.sortContainer.append("select").on("change",function(){a.selection.sort(a.getSortComparator()),a.populateResults()}).node(),d3.select(this.sortNode).selectAll("option").data(this.db.dimensions.filter(function(e){return!a.db.isStringDimension(e)})).enter().append("option").attr("value",function(e){return e}).text(function(e){return e}),this.sortOrderContainer=this.header.append("div").classed("controlPanel sortOrder",!0),this.sortOrderContainer.append("span").classed("label",!0).text("Reverse Sort Order:"),this.sortOrderContainer.append("br"),this.sortOrderNode=this.sortOrderContainer.append("input").attr("type","checkbox").on("input",function(){a.selection.sort(a.getSortComparator()),a.populateResults()}).node(),this.imageSizeContainer=this.header.append("div").classed("controlPanel imageSize",!0),this.imageSizeContainer.append("span").classed("label",!0).text("Image Size: 150px"),this.imageSizeContainer.append("br"),this.imageSizeNode=this.imageSizeContainer.append("input").attr("type","range").attr("min","100").attr("max","500").on("input",function(){d3.select(a.container).selectAll(".display").style("width",this.value+"px"),d3.select(a.container).select(".controlPanel.imageSize .label").text("Image Size: "+this.value+"px")}).node(),this.imageSizeNode.value=150,this.updateSize()):void(this.noFileWarning=d3.select(this.container).append("div").classed("noFileWarning",!0).text("No file information to display"))},n.ImageSpread.prototype=Object.create(n.Component.prototype),n.ImageSpread.prototype.constructor=n.ImageSpread,n.ImageSpread.prototype.updateSize=function(){if(n.Component.prototype.updateSize.call(this),this.hasFileDimensions){var e=this.header.node().getBoundingClientRect().height;this.imageContainer.style("top",e+"px").style("height",this.parentRect.height-e+"px")}},n.ImageSpread.prototype.setSelection=function(e){this.selection=e,this.selection.sort(this.getSortComparator()),this.updatePageNav(),this.populateResults()},n.ImageSpread.prototype.getSortComparator=function(){var e=this,t=this.sortNode.value;return this.sortOrderNode.checked?function(n,a){return void 0===e.db.data[n][t]?1:void 0===e.db.data[a][t]?-1:isNaN(e.db.data[n][t])?1:isNaN(e.db.data[a][t])?-1:e.db.data[a][t]-e.db.data[n][t]}:function(n,a){return void 0===e.db.data[n][t]?-1:void 0===e.db.data[a][t]?1:isNaN(e.db.data[n][t])?-1:isNaN(e.db.data[a][t])?1:e.db.data[n][t]-e.db.data[a][t]}},n.ImageSpread.prototype.populateResults=function(){var e=this;if(this.hasFileDimensions){var n=this.pageSizeNode.value,i=this.selection.slice((this.currentPage-1)*n,Math.min(this.currentPage*n,this.selection.length)),o=this.imageContainer.selectAll(".dataDisplay").data(i);o.exit().remove(),o.enter().append("div").classed("dataDisplay",!0).merge(o).on("mouseenter",function(t){e.dispatch.call("mouseover",e,t,d3.event)}).on("mouseleave",function(){e.dispatch.call("mouseover",e,null,d3.event)}).each(function(n){var i=e.dimensions.map(function(t){return e.db.data[n][t]}),o=d3.select(this).selectAll(".fileDisplay").data(i);o.exit().remove();var s=o.enter().append("div").classed("fileDisplay",!0);s.append("div").classed("display",!0).style("width",e.imageSizeNode.value+"px"),s.append("div").classed("displayLabel",!0);s.merge(o).each(function(n,o){d3.select(this).select(".display").html("");var i=a(n);t(i)?"VTI"===i.toUpperCase()?d3.select(this).select(".display").classed("image",!0).classed("text",!1).append("img").attr("src","https://kitware.github.io/vtk-js/logo.svg").attr("width","100%").on("click",function(){e.createModalVTI(e.db.directory+"/"+n)}):"PDB"===i.toUpperCase()?d3.select(this).select(".display").classed("image",!0).classed("text",!1).append("img").attr("src","https://kitware.github.io/vtk-js/logo.svg").attr("width","100%").on("click",function(){e.createModalPDB(e.db.directory+"/"+n)}):d3.select(this).select(".display").classed("image",!0).classed("text",!1).append("img").attr("src",e.db.directory+"/"+n).attr("width","100%").on("click",e.createModalImg):d3.select(this).select(".display").classed("text",!0).classed("image",!1).append("div").attr("class","resultErrorText").text("Cannot display file: "+n),d3.select(this).select(".displayLabel").text(e.dimensions[o])})})}},n.ImageSpread.prototype.createModalImg=function(){d3.select("body").append("div").attr("class","modalBackground").on("click",function(){d3.select(this).remove()}).append("img").attr("class","modalImg").attr("src",d3.select(this).attr("src"))},n.ImageSpread.prototype.createModalVTI=function(e){const t=d3.select("body"),a=d3.select("body").append("div");a.attr("class","modalBackground").on("click",function(){d3.select(this).remove()});const n=a.append("div");n.attr("class","modalViewer").on("click",function(){d3.event.stopPropagation()});var i={};const o=[0,0,0],s=vtk.Rendering.Misc.vtkFullScreenRenderWindow.newInstance({background:o,rootContainer:t.node(),container:n.node()}),r=s.getRenderer(),d=s.getRenderWindow(),l=vtk.IO.Misc.vtkPDBReader.newInstance(),c=vtk.Filters.General.vtkMoleculeToRepresentation.newInstance(),p=vtk.Rendering.Core.vtkSphereMapper.newInstance(),h=vtk.Rendering.Core.vtkStickMapper.newInstance(),g=vtk.Rendering.Core.vtkActor.newInstance(),u=vtk.Rendering.Core.vtkActor.newInstance(),m=vtk.IO.XML.vtkXMLImageDataReader.newInstance();c.setInputConnection(l.getOutputPort()),c.setHideElements(["H"]),p.setInputConnection(c.getOutputPort(0)),p.setScaleArray(c.getSphereScaleArrayName()),g.setMapper(p),h.setInputConnection(c.getOutputPort(1)),h.setScaleArray("stickScales"),h.setOrientationArray("orientation"),u.setMapper(h),vtk.IO.Core.DataAccessHelper.get().fetchBinary(e,{function(e){console.log(e)}}).then(e=>{m.parseAsArrayBuffer(e);const t=m.getOutputData(0),a=vtk.Rendering.Core.vtkVolumeMapper.newInstance(),l=vtk.Rendering.Core.vtkVolume.newInstance(),c=t.getPointData().getScalars()||t.getPointData().getArrays()[0],p=c.getRange(),h=vtk.Rendering.Core.vtkColorTransferFunction.newInstance(),g=vtk.Common.DataModel.vtkPiecewiseFunction.newInstance();l.setMapper(a),a.setInputData(t),r.addActor(l);const u=.7*Math.sqrt(t.getSpacing().map(e=>e*e).reduce((e,t)=>e+t,0));a.setSampleDistance(u),l.getProperty().setRGBTransferFunction(0,h),l.getProperty().setScalarOpacity(0,g),l.getProperty().setInterpolationTypeToLinear(),l.getProperty().setScalarOpacityUnitDistance(0,vtk.Common.DataModel.vtkBoundingBox.getDiagonalLength(t.getBounds())/Math.max(...t.getDimensions())),l.getProperty().setGradientOpacityMinimumValue(0,0),l.getProperty().setGradientOpacityMaximumValue(0,.05*(p[1]-p[0])),l.getProperty().setShade(!0),l.getProperty().setUseGradientOpacity(0,!0),l.getProperty().setGradientOpacityMinimumOpacity(0,0),l.getProperty().setGradientOpacityMaximumOpacity(0,1),l.getProperty().setAmbient(.2),l.getProperty().setDiffuse(.7),l.getProperty().setSpecular(.3),l.getProperty().setSpecularPower(8);const y=vtk.Interaction.UI.vtkVolumeController.newInstance({size:[400,150],rescaleColorMap:!0}),P=1.5>o[0]+o[1]+o[2];y.setContainer(n.node()),y.setupContent(d,l,P),s.setResizeCallback(({width:e,height:t})=>{414<e?y.setSize(400,150):y.setSize(e-14,150),y.render()}),r.resetCamera(),d.render(),i.pipeline={actor:l,renderer:r,renderWindow:d,lookupTable:h,mapper:a,source:t,piecewiseFunction:g,fullScreenRenderer:s}})},n.ImageSpread.prototype.createModalPDB=function(e){const t=d3.select("body"),a=d3.select("body").append("div");a.attr("class","modalBackground").on("click",function(){d3.select(this).remove()});const n=a.append("div");n.attr("class","modalViewer").on("click",function(){d3.event.stopPropagation()});var i={};const o=vtk.Rendering.Misc.vtkFullScreenRenderWindow.newInstance({background:[0,0,0],rootContainer:t.node(),container:n.node()}),s=o.getRenderer(),r=o.getRenderWindow(),d=vtk.IO.Misc.vtkPDBReader.newInstance(),l=vtk.Filters.General.vtkMoleculeToRepresentation.newInstance(),c=vtk.Rendering.Core.vtkSphereMapper.newInstance(),p=vtk.Rendering.Core.vtkStickMapper.newInstance(),h=vtk.Rendering.Core.vtkActor.newInstance(),g=vtk.Rendering.Core.vtkActor.newInstance();l.setInputConnection(d.getOutputPort()),l.setHideElements(["H"]),c.setInputConnection(l.getOutputPort(0)),c.setScaleArray(l.getSphereScaleArrayName()),h.setMapper(c),p.setInputConnection(l.getOutputPort(1)),p.setScaleArray("stickScales"),p.setOrientationArray("orientation"),g.setMapper(p),d.setUrl(e).then(()=>{s.resetCamera(),r.render()}),s.addActor(h),s.addActor(g),s.resetCamera(),r.render(),i.reader=d,i.filter=l,i.sphereMapper=c,i.stickMapper=p,i.sphereActor=h,i.stickActor=g,i.renderer=s,i.renderWindow=r},n.ImageSpread.prototype.updatePageNav=function(){var t=this;d3.select(this.container).select(".pageNavWrapper").remove();var a=this.pageSizeNode.value;if(this.selection.length>a){var n=Math.ceil(this.selection.length/a);this.currentPage>n&&(this.currentPage=n),d3.select(this.container).append("div").classed("pageNavWrapper",!0).append("ul").classed("pageNav",!0).selectAll("li").data(e(n,this.currentPage)).enter().append("li").classed("pageButton",!0).attr("mode",function(e){return e.page==t.currentPage?"selected":"default"}).text(function(e){return e.text}).on("click",function(e){"selected"!=d3.select(this).attr("mode")&&(t.currentPage=e.page,e.do_rebuild?(t.updatePageNav(),t.populateResults()):(d3.select(t.container).select(".pageButton[mode=\"selected\"]").attr("mode","default"),d3.select(this).attr("mode","selected"),d3.select(".pageReadout").text(t.currentPage+" / "+n),t.populateResults()))}),d3.select(".pageNavWrapper").append("div").classed("pageReadout",!0).text(this.currentPage+" / "+n)}else this.currentPage=1}}(),"use strict",function(){function e(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!=t.length)return!1;for(var a=0;a<e.length;++a)if(e[a]!==t[a])return!1;return!0}var t={};if(window.CINEMA_COMPONENTS?t=window.CINEMA_COMPONENTS:window.CINEMA_COMPONENTS=t,!t.COMPONENT_INCLUDED)throw new Error("CINEMA_COMPONENTS Pcoord module requires that Component module be included. Please make sure that Component module is included BEFORE Pcoord module");if(!window.d3)throw new Error("CINEMA_COMPONENTS Pcoord module requires that d3 be included (at least d3v4). Please make sure that d3 is included BEFORE the the Pcoord module");t.PCOORD_INCLUDED=!0,t.Pcoord=function(a,n,i){if(this.constructor===t.Pcoord)throw new Error("Cannot instantiate abstract class 'Pcoord' Please use a subclass");var o=this;this.margin=new t.Margin(30,10,10,10),this.NaNMargin,t.Component.call(this,a,n,i),this.NaNMargin=this.internalHeight/11,this.selection=d3.range(0,this.db.data.length),this.highlighted=[],this.overlayData=[],this.dispatch=d3.dispatch("selectionchange","mouseover","click","axisorderchange"),this.x=d3.scalePoint().domain(this.dimensions).range([0,this.internalWidth]).padding(1),this.y={},this.dimensions.forEach(function(e){o.db.isStringDimension(e)?(!o.y[e]&&(o.y[e]=d3.scalePoint()),o.y[e].domain(o.db.dimensionDomains[e]).range([o.internalHeight,0])):(!o.y[e]&&(o.y[e]=d3.scaleLinear()),o.y[e].domain(o.db.dimensionDomains[e]).range([o.internalHeight-o.NaNMargin,0]))}),this.dragging={},this.axisDragStart=function(e){o.dragging[e]=o.x(e),o.axes.sort(function(t,a){return t==e?1:a==e?-1:0})},this.axisDrag=function(t){o.dragging[t]=Math.min(o.internalWidth,Math.max(0,d3.event.x)),o.redrawPaths();var a=o.dimensions.slice();o.dimensions.sort(function(e,t){return o.getXPosition(e)-o.getXPosition(t)}),e(a,o.dimensions)||o.dispatch.call("axisorderchange",o,o.dimensions),o.x.domain(o.dimensions),o.axes.attr("transform",function(e){return"translate("+o.getXPosition(e)+")"})},this.axisDragEnd=function(e){delete o.dragging[e],d3.select(this).attr("transform","translate("+o.x(e)+")"),o.axes.sort(function(e,t){return o.x(e)-o.x(t)}),o.redrawPaths()},this.drag=d3.drag().subject(function(e){return{x:o.x(e)}}).on("start",this.axisDragStart).on("drag",this.axisDrag).on("end",this.axisDragEnd),this.brushExtents={},this.dontUpdateSelectionOnBrush=!1,this.axisBrush=function(e){null!=d3.event&&(o.brushExtents[e]=d3.event.selection,null!=o.brushExtents[e]&&o.brushExtents[e][0]===o.brushExtents[e][1]&&delete o.brushExtents[e]),o.dontUpdateSelectionOnBrush||o.updateSelection()},this.brush=d3.brushY().extent([[-8,0],[8,this.internalHeight]]).on("start",function(){d3.event.sourceEvent.stopPropagation()}).on("start brush",this.axisBrush),d3.select(this.container).classed("PCOORD",!0),this.pathContainer=d3.select(this.container).append("div").classed("pathContainer",!0).style("position","absolute").style("width",this.parentRect.width+"px").style("height",this.parentRect.height+"px"),this.smoothPaths=!0,this.axisContainer=d3.select(this.container).append("svg").classed("axisContainer",!0).style("position","absolute").attr("viewBox",-this.margin.right+" "+-this.margin.top+" "+this.parentRect.width+" "+this.parentRect.height).attr("preserveAspectRatio","none").attr("width","100%").attr("height","100%").style("pointer-events","none"),this.axes=this.axisContainer.selectAll(".axisGroup").data(this.dimensions).enter().append("g").classed("axisGroup",!0).attr("transform",function(e){return"translate("+o.x(e)+")"}).call(this.drag),this.axes.append("g").classed("axis",!0).each(function(e){d3.select(this).call(d3.axisLeft().scale(o.y[e])),o.db.isStringDimension(e)||o.addNaNExtensionToAxis(this)});var s=this.axes.append("g").classed("axisLabel",!0).style("pointer-events","initial");s.append("text").style("text-anchor","middle").attr("y",-9).text(function(e){return e}),s.insert("rect",":first-child").data(function(){var e=[];return s.selectAll("text").each(function(){e.push(this.getBBox())}),e}).attr("x",function(e){return e.x+3}).attr("y",function(e){return e.y}).attr("width",function(e){return e.width-6}).attr("height",function(e){return e.height}),this.axes.append("g").classed("brush",!0).each(function(){d3.select(this).call(o.brush)})},t.Pcoord.prototype=Object.create(t.Component.prototype),t.Pcoord.prototype.constructor=t.Pcoord,t.Pcoord.prototype.addNaNExtensionToAxis=function(e){d3.select(e).append("path").attr("class","NaNExtension").attr("d","M0.5,"+(this.internalHeight-this.NaNMargin+.5+"V")+(this.internalHeight-.5+""));var t=d3.select(e).append("g").attr("class","NaNExtensionTick").attr("transform","translate(0,"+(this.internalHeight-.5+")"));t.append("line").attr("x2","-6"),t.append("text").attr("x","-9").attr("dy","0.32em").text("NaN")},t.Pcoord.prototype.updateSize=function(){var e=this,a=this.internalHeight;t.Component.prototype.updateSize.call(this),this.NaNMargin=this.internalHeight/11,this.pathContainer.style("width",this.parentRect.width+"px").style("height",this.parentRect.height+"px"),this.x.range([0,this.internalWidth]),this.dimensions.forEach(function(t){e.y[t].range([e.db.isStringDimension(t)?e.internalHeight:e.internalHeight-e.NaNMargin,0])}),this.redrawPaths(),this.axisContainer.attr("viewBox",-this.margin.right+" "+-this.margin.top+" "+this.parentRect.width+" "+this.parentRect.height),this.axes.attr("transform",function(t){return"translate("+e.getXPosition(t)+")"}),this.axes.each(function(t){d3.select(this).select(".axis").call(d3.axisLeft().scale(e.y[t])),e.db.isStringDimension(t)||(d3.select(this).select("path.NaNExtension").attr("d","M0.5,"+(e.internalHeight-e.NaNMargin+.5+"V")+(e.internalHeight-.5+"")),d3.select(this).select(".NaNExtensionTick").attr("transform","translate(0,"+(e.internalHeight-.5+")")))}),this.dontUpdateSelectionOnBrush=!0,this.brush.extent([[-8,0],[8,this.internalHeight]]),this.axes.selectAll("g.brush").each(function(t){d3.select(this).call(e.brush),d3.select(this).call(e.brush.move,function(){return null==e.brushExtents[t]?null:e.brushExtents[t].map(function(t){return t/a*e.internalHeight})})}),this.dontUpdateSelectionOnBrush=!1},t.Pcoord.prototype.updateData=function(){var e=this;this.dimensions.forEach(function(t){e.y[t].domain(e.db.dimensionDomains[t])}),this.axes.each(function(t){d3.select(this).select(".axis").call(d3.axisLeft().scale(e.y[t]))}),this.updateSelection(!0)},t.Pcoord.prototype.updateSelection=function(t){var a=this,n=[];this.db.data.forEach(function(e,t){var i=!0;for(var o in a.dimensions){var s=a.brushExtents[a.dimensions[o]];if(s){var r=a.getYPosition(a.dimensions[o],e);if(i=i&&s[0]<=r&&r<=s[1],!i)break}}i&&n.push(t)}),(!e(this.selection,n)||t)&&(this.selection=n,this.dispatch.call("selectionchange",this,this.selection.slice()),this.redrawSelectedPaths())},t.Pcoord.prototype.setHighlightedPaths=function(e){this.highlighted=e,this.redrawHighlightedPaths()},t.Pcoord.prototype.setOverlayPaths=function(e){this.overlayData=e,this.redrawOverlayPaths()},t.Pcoord.prototype.redrawPaths=function(){this.redrawSelectedPaths(),this.redrawHighlightedPaths(),this.redrawOverlayPaths()},t.Pcoord.prototype.setSelection=function(e){var t={},a=this;this.dimensions.forEach(function(n){t[n]=d3.extent(e,function(e){return a.getYPosition(n,a.db.data[e])})}),this.axes.selectAll("g.brush").each(function(e){d3.select(this).call(a.brush.move,function(){return[t[e][0]-5,t[e][1]+5]})}),this.axisBrush()},t.Pcoord.prototype.setAxisOrder=function(e){var t=this,e=e.filter(function(e){return t.dimensions.includes(e)});this.dimensions.forEach(function(t){e.includes[t]||e.push(t)}),this.x.domain(e),t.dimensions.sort(function(e,a){return t.getXPosition(e)-t.getXPosition(a)}),this.axes.attr("transform",function(e){return"translate("+t.getXPosition(e)+")"}),t.axes.sort(function(e,a){return t.x(e)-t.x(a)}),this.redrawPaths()},t.Pcoord.prototype.redrawSelectedPaths=function(){throw new Error("Cannot call abstract function 'redrawSelectedPaths()'! Please override function in a subclass")},t.Pcoord.prototype.redrawHighlightedPaths=function(){throw new Error("Cannot call abstract function 'redrawHighlightedPaths()'! Please override function in a subclass")},t.Pcoord.prototype.redrawOverlayPaths=function(){throw new Error("Cannot call abstract function 'redrawOverlayPaths()'! Please override function in a subclass")},t.Pcoord.prototype.getPath=function(e){var t=this,a=this.smoothPaths?this.internalWidth/this.dimensions.length/3:0,n=this.internalWidth/this.dimensions.length/5,o="",i=[],s=[];return this.dimensions.forEach(function(t){null==e[t]?0!=s.length&&(i.push(s.slice()),s=[]):s.push(t)}),0<s.length&&i.push(s.slice()),i.forEach(function(s){if(1==s.length){var i=s[0],r=t.getXPosition(i),d=t.getYPosition(i,e);o+="M "+(r-n/2)+" "+d+" L "+(r+n/2+" "+d)}else s.forEach(function(n,r){var i=t.getXPosition(n),d=t.getYPosition(n,e);o+=0==r?"M "+i+" "+d+" C "+(i+a+" "+d+" "):r==s.length-1?i-a+" "+d+" "+(i+" "+d+" "):i-a+" "+d+" "+(i+" "+d+" ")+(i+a+" "+d+" ")})}),o},t.Pcoord.prototype.getXPosition=function(e){var t=this.dragging[e];return null==t?this.x(e):t},t.Pcoord.prototype.getYPosition=function(e,t){return!this.db.isStringDimension(e)&&isNaN(t[e])?this.internalHeight:this.y[e](t[e])}}(),"use strict",function(){var e=Math.floor,t={};if(window.CINEMA_COMPONENTS?t=window.CINEMA_COMPONENTS:window.CINEMA_COMPONENTS=t,!t.PCOORD_INCLUDED)throw new Error("CINEMA_COMPONENTS PcoordCanvas Component requires that Pcoord component be included. Please make sure that Pcoord component is included BEFORE PcoordCanvas module");t.PCOORD_CANVAS_INCLUDED=!0,t.PcoordCanvas=function(e,n,i){var o=this;t.Pcoord.call(this,e,n,i),d3.select(this.container).classed("CANVAS",!0),this.selectedCanvas=this.pathContainer.append("canvas").classed("selectedCanvas",!0).node(),this.highlightedCanvas=this.pathContainer.append("canvas").classed("highlightedCanvas",!0).node(),this.overlayCanvas=this.pathContainer.append("canvas").classed("overlayCanvas",!0).node(),this.indexCanvas=this.pathContainer.append("canvas").classed("indexCanvas",!0).style("display","none").node(),this.pathContainer.selectAll("canvas").style("position","absolute").style("top",this.margin.top+"px").style("left",this.margin.left+"px"),this.pixelRatio=function(){var e=document.createElement("canvas").getContext("2d"),t=window.devicePixelRatio||1,a=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return t/a}(),this.loading=d3.select(this.container).append("div").classed("loadingIndicator",!0).style("display","none").text("Drawing..."),this.interval=setInterval(function(e){for(var t=0;25>t;t++)e.drawIterator&&e.drawIterator.next().done&&(e.drawIterator=void 0,e.loading.style("display","none"))},16,this),this.lastMouseMove=null,this.pathContainer.on("mousemove",function(){var e=d3.mouse(o.selectedCanvas)[0]*o.pixelRatio,t=d3.mouse(o.selectedCanvas)[1]*o.pixelRatio;if(0<=e&&0<=t){var n=a(e,t,o.indexCanvas);-1==n?null!==o.lastMouseMove&&(o.lastMouseMove=null,o.dispatch.call("mouseover",o,null,d3.event)):o.lastMouseMove!=o.selection[n]&&(o.lastMouseMove=o.selection[n],o.dispatch.call("mouseover",o,o.selection[n],d3.event))}}),this.updateSize()},t.PcoordCanvas.prototype=Object.create(t.Pcoord.prototype),t.PcoordCanvas.prototype.constructor=t.PcoordCanvas,t.PcoordCanvas.prototype.updateSize=function(){var e=this;t.Pcoord.prototype.updateSize.call(this),this.pathContainer.selectAll("canvas").style("width",this.internalWidth+"px").style("height",this.internalHeight+"px").attr("width",this.internalWidth*this.pixelRatio+"px").attr("height",this.internalHeight*this.pixelRatio+"px").each(function(){this.getContext("2d").scale(e.pixelRatio,e.pixelRatio)});var a=this.selectedCanvas.getContext("2d");a.strokeStyle="lightgray",a.globalAlpha=.3,a.lineWidth=2;var n=this.highlightedCanvas.getContext("2d");n.strokeStyle="lightskyblue",n.lineWidth=4;var i=this.indexCanvas.getContext("2d");i.lineWidth=3,this.redrawPaths()},t.PcoordCanvas.prototype.redrawSelectedPaths=function(){var e=this,t=this.selectedCanvas.getContext("2d");t.clearRect(0,0,this.internalWidth,this.internalHeight);var a=this.indexCanvas.getContext("2d");a.clearRect(0,0,this.internalWidth,this.internalHeight),this.drawIterator=function*(o){e.loading.style("display","initial");for(var s,r=0;r<o.length;)s=new Path2D(e.getPath(e.db.data[o[r]])),t.stroke(s),a.strokeStyle=n(r),a.stroke(s),yield++r}(this.selection)},t.PcoordCanvas.prototype.redrawHighlightedPaths=function(){var e=this,t=this.highlightedCanvas.getContext("2d");t.clearRect(0,0,this.internalWidth,this.internalHeight),this.highlighted.forEach(function(a){var n=new Path2D(e.getPath(e.db.data[a]));t.stroke(n)})},t.PcoordCanvas.prototype.redrawOverlayPaths=function(){var e=this,t=this.overlayCanvas.getContext("2d");t.clearRect(0,0,this.internalWidth,this.internalHeight),this.overlayData.forEach(function(a){t.lineWidth=a.style.lineWidth||1,t.lineCap=a.style.lineCap||"butt",t.lineJoin=a.style.lineJoin||"miter",t.miterLimit=a.style.miterLimit||10,t.strokeStyle=a.style.strokeStyle||"black",a.style.lineDash?t.setLineDash(a.style.lineDash):t.setLineDash([]);var n=new Path2D(e.getPath(a.data));t.stroke(n)})},t.PcoordCanvas.prototype.destroy=function(){clearInterval(this.interval),t.Component.prototype.destroy.call(this)};var a=function(e,t,a){for(var n=a.getContext("2d").getImageData(e-1,t-1,3,3).data,s=[],r=0;r<n.length/4;r++)s.push(o(n.slice(4*r,4*r+3)));s.sort();for(var d=-1,l=0,c=-1,r=0;r<s.length;r++)if(c!=s[r])l=1,c=s[r];else if(l++,5==l){d=c;break}return d},n=function(t){if(16777216<t)return"rgb(255,255,255)";t++;var a=e(t/256/256),n=e((t-256*(256*a))/256),o=t-256*(256*a)-256*n;return"rgb("+o+","+n+","+a+")"},o=function(e){return e[0]+256*e[1]+256*(256*e[2])-1}}(),"use strict",function(){var e={};if(window.CINEMA_COMPONENTS?e=window.CINEMA_COMPONENTS:window.CINEMA_COMPONENTS=e,!e.PCOORD_INCLUDED)throw new Error("CINEMA_COMPONENTS PcoordSVG Component requires that Pcoord component be included. Please make sure that Pcoord component is included BEFORE PcoordSVG module");e.PCOORDSVG_INCLUDED=!0,e.PcoordSVG=function(t,a,n){e.Pcoord.call(this,t,a,n),d3.select(this.container).classed("SVG",!0),this.svg=this.pathContainer.append("svg").style("position","absolute").style("top",this.margin.top+"px").style("left",this.margin.left+"px").attr("width",this.internalWidth+"px").attr("height",this.internalHeight+"px"),this.selectedPaths=this.svg.append("g").classed("selectedPaths",!0),this.highlightedPaths=this.svg.append("g").classed("highlightedPaths",!0),this.overlayPaths=this.svg.append("g").classed("overlayPaths",!0),this.redrawPaths()},e.PcoordSVG.prototype=Object.create(e.Pcoord.prototype),e.PcoordSVG.prototype.constructor=e.PcoordSVG,e.PcoordSVG.prototype.updateSize=function(){e.Pcoord.prototype.updateSize.call(this),this.svg.attr("width",this.internalWidth+"px").attr("height",this.internalHeight+"px")},e.PcoordSVG.prototype.redrawSelectedPaths=function(){var e=this,t=this.selectedPaths.selectAll("path").data(this.selection);t.enter().append("path").merge(t).attr("index",function(e){return e}).attr("d",function(t){return e.getPath(e.db.data[t])}).on("mouseenter",function(t){e.dispatch.call("mouseover",e,t,d3.event)}).on("mouseleave",function(){e.dispatch.call("mouseover",e,null,d3.event)}).on("click",function(t){e.dispatch.call("click",e,t)}),t.exit().remove()},e.PcoordSVG.prototype.redrawHighlightedPaths=function(){var e=this,t=this.highlightedPaths.selectAll("path").data(this.highlighted);t.enter().append("path").merge(t).attr("index",function(e){return e}).attr("d",function(t){return e.getPath(e.db.data[t])}),t.exit().remove()},e.PcoordSVG.prototype.redrawOverlayPaths=function(){var e=this,t=this.overlayPaths.selectAll("path").data(this.overlayData);t.enter().append("path").merge(t).attr("style",function(e){return e.style}).attr("d",function(t){return e.getPath(t.data)}),t.exit().remove()}}(),"use strict",function(){var e={};if(window.CINEMA_COMPONENTS?e=window.CINEMA_COMPONENTS:window.CINEMA_COMPONENTS=e,!e.COMPONENT_INCLUDED)throw new Error("CINEMA_COMPONENTS Query module requires that Component module be included. Please make sure that Component module is included BEFORE Query module");if(!window.d3)throw new Error("CINEMA_COMPONENTS Query module requires that d3 be included (at least d3v4). Please make sure that d3 is included BEFORE the the Query module");e.QUERY_INCLUDED=!0,e.Query=function(t,a){var n=this;e.Component.call(this,t,a),this.dimensions=this.dimensions.filter(function(e){return!n.db.isStringDimension(e)}),this.results=[],this.custom=new e.ExtraData({},""),this.upper=new e.ExtraData({},""),this.lower=new e.ExtraData({},""),this.dispatch=d3.dispatch("query","customchange"),this.scales={},this.dimensions.forEach(function(e){n.scales[e]=d3.scaleLinear().domain([0,100]).range(n.db.dimensionDomains[e])}),d3.select(this.container).classed("QUERY",!0),this.queryButton=d3.select(this.container).append("button").classed("queryButton",!0).text("Find Similar").on("click",function(){var e=n.db.getSimilar(n.custom.data,n.thresholdNode.value);d3.select(n.readout).text(e.length+" results found!"),n.dispatch.call("query",n,e.slice())}).node(),this.thresholdLabel=d3.select(this.container).append("span").classed("thresholdLabel",!0).text("Threshold:").node(),this.thresholdNode=d3.select(this.container).append("input").classed("thresholdInput",!0).attr("type","number").attr("max",this.dimensions.length).attr("min",0).attr("step",.05).on("change",function(){n.updateBounds(),n.dispatch.call("customchange",n,[n.custom,n.upper,n.lower])}).node(),this.thresholdNode.value=1,this.readout=d3.select(this.container).append("span").classed("readout",!0).node(),this.rows=d3.select(this.container).selectAll(".inputRow").data(this.dimensions).enter().append("div").classed("inputRow",!0).style("position","relative"),this.rows.append("span").classed("label",!0).style("position","absolute").text(function(e){return e}),this.rows.append("input").attr("type","checkbox").style("position","absolute").on("input",function(e){if(this.checked){var t=d3.select(this.parentNode).select("input[type=\"range\"]");n.custom.data[e]=n.scales[e](t.node().value)}else delete n.custom.data[e];n.updateBounds(),n.dispatch.call("customchange",n,[n.custom,n.upper,n.lower])}),this.rows.append("input").attr("type","range").attr("min",0).attr("max",100).attr("step",1).each(function(){this.value=50}).style("position","absolute").on("input",function(e){var t=d3.select(this.parentNode).select("input[type=\"checkbox\"]");t.node().checked||(t.node().checked=!0),n.custom.data[e]=n.scales[e](this.value),n.updateBounds(),n.dispatch.call("customchange",n,[n.custom,n.upper,n.lower])})},e.Query.prototype=Object.create(e.Component.prototype),e.Query.prototype.constructor=e.Query,e.Query.prototype.updateData=function(){var e=this;this.dimensions.forEach(function(t){e.scales[t].range(e.db.dimensionDomains[t])})},e.Query.prototype.updateBounds=function(){var e=this,t=this.thresholdNode.value,a=100*(t/d3.keys(this.custom.data).length);this.upper.data={},this.lower.data={},this.dimensions.forEach(function(t){if(void 0!==e.custom.data[t]){var n=e.scales[t];e.lower.data[t]=n(Math.max(n.invert(e.custom.data[t])-a,0)),e.upper.data[t]=n(Math.min(n.invert(e.custom.data[t])+a,100))}})}}(),"use strict",function(){var e={};if(window.CINEMA_COMPONENTS?e=window.CINEMA_COMPONENTS:window.CINEMA_COMPONENTS=e,!e.COMPONENT_INCLUDED)throw new Error("CINEMA_COMPONENTS ScatterPlot module requires that Component module be included. Please make sure that Component module is included BEFORE ScatterPlot module");if(!window.d3)throw new Error("CINEMA_COMPONENTS ScatterPlot module requires that d3 be included (at least d3v4). Please make sure that d3 is included BEFORE the the ScatterPlot module");e.SCATTER_PLOT_INCLUDED=!0,e.ScatterPlot=function(t,a,n){var i=this;this.margin=new e.Margin(25,25,60,150),e.Component.call(this,t,a,n),this.selection=[],this.highlighted=[],this.overlayData=[],this.xDimension=this.dimensions[0],this.yDimension=this.dimensions[1],this.dispatch=d3.dispatch("mouseover","xchanged","ychanged"),this.x=(this.db.isStringDimension(this.xDimension)?d3.scalePoint():d3.scaleLinear()).domain(this.db.dimensionDomains[this.xDimension]).range([15,this.internalWidth-15]),this.y=(this.db.isStringDimension(this.yDimension)?d3.scalePoint():d3.scaleLinear()).domain(this.db.dimensionDomains[this.yDimension]).range([this.internalHeight-15,15]),d3.select(this.container).classed("SCATTER_PLOT",!0),this.pointContainer=d3.select(this.container).append("div").classed("pointContainer",!0).style("position","absolute").style("top",this.margin.top+"px").style("right",this.margin.right+"px").style("bottom",this.margin.bottom+"px").style("left",this.margin.left+"px").style("width",this.internalWidth+"px").style("height",this.internalHeight+"px"),this.xSelect=d3.select(this.container).append("select").classed("dimensionSelect x",!0).style("position","absolute").node(),this.ySelect=d3.select(this.container).append("select").classed("dimensionSelect y",!0).style("position","absolute").node(),d3.select(this.xSelect).selectAll("option").data(this.dimensions).enter().append("option").attr("value",function(e){return e}).text(function(e){return e}),d3.select(this.xSelect).node().value=this.xDimension,d3.select(this.ySelect).selectAll("option").data(this.dimensions).enter().append("option").attr("value",function(e){return e}).text(function(e){return e}),d3.select(this.ySelect).node().value=this.yDimension,d3.select(this.xSelect).on("input",function(){i.xDimension=this.value,i.x=(i.db.isStringDimension(i.xDimension)?d3.scalePoint():d3.scaleLinear()).domain(i.db.dimensionDomains[i.xDimension]).range([0,i.internalWidth]),i.xAxisContainer.select(".axis").call(d3.axisBottom().scale(i.x)),i.dispatch.call("xchanged",i,i.xDimension),i.redrawPoints()}),d3.select(this.ySelect).on("input",function(){i.yDimension=this.value,i.y=(i.db.isStringDimension(i.yDimension)?d3.scalePoint():d3.scaleLinear()).domain(i.db.dimensionDomains[i.yDimension]).range([i.internalHeight,0]),i.yAxisContainer.select(".axis").call(d3.axisLeft().scale(i.y)),i.dispatch.call("ychanged",i,i.yDimension),i.redrawPoints()}),this.warningReadout=d3.select(this.container).append("div").classed("warningReadout",!0).style("position","absolute"),this.xAxisContainer=d3.select(this.container).append("svg").classed("axisContainer x",!0).style("position","absolute").style("width",this.internalWidth+"px").style("height","25px").style("top",this.margin.top+this.internalHeight+"px").style("left",this.margin.left+"px"),this.yAxisContainer=d3.select(this.container).append("svg").classed("axisContainer y",!0).style("position","absolute").style("width","50px").style("height",this.internalHeight+"px").style("left",this.margin.left-50+"px").style("top",this.margin.top+"px"),this.xAxisContainer.append("g").classed("axis",!0).call(d3.axisBottom().scale(this.x)),this.yAxisContainer.append("g").classed("axis",!0).attr("transform","translate(50)").call(d3.axisLeft().scale(this.y))},e.ScatterPlot.prototype=Object.create(e.Component.prototype),e.ScatterPlot.prototype.constructor=e.ScatterPlot,e.ScatterPlot.prototype.updateSize=function(){e.Component.prototype.updateSize.call(this),this.pointContainer.style("width",this.internalWidth+"px").style("height",this.internalHeight+"px"),this.x.range([15,this.internalWidth-15]),this.y.range([this.internalHeight-15,15]),this.xAxisContainer.style("top",this.margin.top+this.internalHeight+"px").style("width",this.internalWidth+"px").select(".axis").call(d3.axisBottom().scale(this.x)),this.yAxisContainer.style("height",this.internalHeight+"px").select(".axis").call(d3.axisLeft().scale(this.y)),this.redrawPoints()},e.ScatterPlot.prototype.updateData=function(){this.x.domain(this.db.dimensionDomains[this.xDimension]),this.y.domain(this.db.dimensionDomains[this.yDimension]),this.xAxisContainer.select(".axis").call(d3.axisBottom().scale(this.x)),this.yAxisContainer.select(".axis").call(d3.axisLeft().scale(this.y)),this.redrawPoints()},e.ScatterPlot.prototype.redrawPoints=function(){this.redrawSelectedPoints(),this.redrawHighlightedPoints(),this.redrawOverlayPoints()},e.ScatterPlot.prototype.getPlottablePoints=function(e){var t=this;return e.filter(function(e){var a=t.x(t.db.data[e][t.xDimension]),n=t.y(t.db.data[e][t.yDimension]);return!(isNaN(a)||isNaN(n))})},e.ScatterPlot.prototype.setSelection=function(e){this.selection=e,this.redrawSelectedPoints()},e.ScatterPlot.prototype.setHighlightedPoints=function(e){this.highlighted=e,this.redrawHighlightedPoints()},e.ScatterPlot.prototype.setOverlayPoints=function(e){this.overlayData=e,this.redrawOverlayPaths()},e.ScatterPlot.prototype.redrawSelectedPoints=function(){throw new Error("Cannot call abstract function 'redrawSelectedPoints()'! Please override function in a subclass")},e.ScatterPlot.prototype.redrawHighlightedPoints=function(){throw new Error("Cannot call abstract function 'redrawHighlightedPoints()'! Please override function in a subclass")},e.ScatterPlot.prototype.redrawOverlayPoints=function(){throw new Error("Cannot call abstract function 'redrawOverlayPoints()'! Please override function in a subclass")}}(),"use strict",function(){var e=Math.floor,t=Math.PI,a={};if(window.CINEMA_COMPONENTS?a=window.CINEMA_COMPONENTS:window.CINEMA_COMPONENTS=a,!a.SCATTER_PLOT_INCLUDED)throw new Error("CINEMA_COMPONENTS ScatterPlotCanvas Component requires that ScatterPlot component be included. Please make sure that ScatterPlot component is included BEFORE ScatterPlotCanvas module");a.SCATTER_PLOT_CANVAS_INCLUDED=!0,a.ScatterPlotCanvas=function(e,t,i){var o=this;a.ScatterPlot.call(this,e,t,i),d3.select(this.container).classed("CANVAS",!0),this.plottablePoints=[],this.selectedCanvas=this.pointContainer.append("canvas").classed("selectedCanvas",!0).node(),this.highlightedCanvas=this.pointContainer.append("canvas").classed("highlightedCanvas",!0).node(),this.overlayCanvas=this.pointContainer.append("canvas").classed("overlayCanvas",!0).node(),this.indexCanvas=this.pointContainer.append("canvas").classed("indexCanvas",!0).style("display","none").node(),this.pointContainer.selectAll("canvas").style("position","absolute"),this.pixelRatio=function(){var e=document.createElement("canvas").getContext("2d"),t=window.devicePixelRatio||1,a=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return t/a}(),this.loading=d3.select(this.container).append("div").classed("loadingIndicator",!0).style("display","none").text("Drawing..."),this.interval=setInterval(function(e){for(var t=0;25>t;t++)e.drawIterator&&e.drawIterator.next().done&&(e.drawIterator=void 0,e.loading.style("display","none"))},16,this),this.lastMouseMove=null,this.pointContainer.on("mousemove",function(){var e=d3.mouse(o.selectedCanvas)[0]*o.pixelRatio,t=d3.mouse(o.selectedCanvas)[1]*o.pixelRatio;if(0<=e&&0<=t){var a=n(e,t,o.indexCanvas);-1==a?null!==o.lastMouseMove&&(o.lastMouseMove=null,o.dispatch.call("mouseover",o,null,d3.event)):o.lastMouseMove!=o.plottablePoints[a]&&(o.lastMouseMove=o.plottablePoints[a],o.dispatch.call("mouseover",o,o.plottablePoints[a],d3.event))}}),this.updateSize()},a.ScatterPlotCanvas.prototype=Object.create(a.ScatterPlot.prototype),a.ScatterPlotCanvas.prototype.constructor=a.ScatterPlotCanvas,a.ScatterPlotCanvas.prototype.updateSize=function(){var e=this;a.ScatterPlot.prototype.updateSize.call(this),this.pointContainer.selectAll("canvas").style("width",this.internalWidth+"px").style("height",this.internalHeight+"px").attr("width",this.internalWidth*this.pixelRatio+"px").attr("height",this.internalHeight*this.pixelRatio+"px").each(function(){this.getContext("2d").scale(e.pixelRatio,e.pixelRatio)});var t=this.selectedCanvas.getContext("2d");t.fillStyle="rgba(82, 137, 163, 0.521)",t.strokeStyle="rgb(69, 121, 153)",t.lineWidth=2;var n=this.highlightedCanvas.getContext("2d");n.fillStyle="rgb(252, 127, 127)",n.strokeStyle="rgb(153, 80, 80)",n.lineWidth=3,this.redrawPoints()},a.ScatterPlotCanvas.prototype.redrawSelectedPoints=function(){var e=this;this.plottablePoints=this.getPlottablePoints(this.selection),this.plottablePoints.length<this.selection.length?this.warningReadout.text(this.selection.length-this.plottablePoints.length+" point(s) could not be plotted (because they contain NaN or undefined values)."):this.warningReadout.text("");var a=this.selectedCanvas.getContext("2d");a.clearRect(0,0,this.internalWidth,this.internalHeight);var n=this.indexCanvas.getContext("2d");n.clearRect(0,0,this.internalWidth,this.internalHeight),this.drawIterator=function*(s){e.loading.style("display","initial");for(var r=0;r<s.length;){var d=e.x(e.db.data[s[r]][e.xDimension]),l=e.y(e.db.data[s[r]][e.yDimension]);a.beginPath(),a.arc(d,l,6,0,2*t),a.fill(),a.stroke(),n.fillStyle=o(r),n.beginPath(),n.arc(d,l,10,0,2*t),n.fill(),yield++r}}(this.plottablePoints)},a.ScatterPlotCanvas.prototype.redrawHighlightedPoints=function(){var e=this,a=this.getPlottablePoints(this.highlighted),n=this.highlightedCanvas.getContext("2d");n.clearRect(0,0,this.internalWidth,this.internalHeight),a.forEach(function(a){var i=e.x(e.db.data[a][e.xDimension]),o=e.y(e.db.data[a][e.yDimension]);n.beginPath(),n.arc(i,o,10,0,2*t),n.fill(),n.stroke()})},a.ScatterPlotCanvas.prototype.redrawOverlayPoints=function(){var e=this,a=this.overlayCanvas.getContext("2d");a.clearRect(0,0,this.internalWidth,this.internalHeight),this.overlayData.forEach(function(n){a.lineWidth=n.style.lineWidth||0,a.lineCap=n.style.lineCap||"butt",a.lineJoin=n.style.lineJoin||"miter",a.miterLimit=n.style.miterLimit||10,a.strokeStyle=n.style.strokeStyle||"black",a.fillStyle=n.style.fillStyle||"black",n.style.lineDash?a.setLineDash(n.style.lineDash):a.setLineDash([]);var i=e.x(n.data[e.xDimension]),o=e.y(n.data[e.yDimension]);a.beginPath(),a.arc(i,o,n.style.r||6,0,2*t),a.fill(),a.stroke()})};var n=function(e,t,a){for(var n=a.getContext("2d").getImageData(e-1,t-1,3,3).data,o=[],r=0;r<n.length/4;r++)o.push(s(n.slice(4*r,4*r+3)));o.sort();for(var d=-1,l=0,c=-1,r=0;r<o.length;r++)if(c!=o[r])l=1,c=o[r];else if(l++,5==l){d=c;break}return d},o=function(t){if(16777216<t)return"rgb(255,255,255)";t++;var a=e(t/256/256),n=e((t-256*(256*a))/256),o=t-256*(256*a)-256*n;return"rgb("+o+","+n+","+a+")"},s=function(e){return e[0]+256*e[1]+256*(256*e[2])-1}}(),"use strict",function(){var e={};if(window.CINEMA_COMPONENTS?e=window.CINEMA_COMPONENTS:window.CINEMA_COMPONENTS=e,!e.SCATTER_PLOT_INCLUDED)throw new Error("CINEMA_COMPONENTS ScatterPlotSVG Component requires that ScatterPlot component be included. Please make sure that ScatterPlot component is included BEFORE ScatterPlotSVG module");e.SCATTER_PLOT_SVG_INCLUDED=!0,e.ScatterPlotSVG=function(t,a,n){e.ScatterPlot.call(this,t,a,n),d3.select(this.container).classed("SVG",!0),this.svg=this.pointContainer.append("svg").style("position","absolute").attr("viewBox","0 0 "+this.internalWidth+" "+this.internalHeight).attr("preserveAspectRatio","none").attr("width","100%").attr("height","100%"),this.selectedPoints=this.svg.append("g").classed("selectedPoints",!0),this.highlightedPoints=this.svg.append("g").classed("highlightedPoints",!0),this.overlayPoints=this.svg.append("g").classed("overlayPoints",!0),this.redrawPoints()},e.ScatterPlotSVG.prototype=Object.create(e.ScatterPlot.prototype),e.ScatterPlotSVG.prototype.constructor=e.ScatterPlotSVG,e.ScatterPlotSVG.prototype.updateSize=function(){e.ScatterPlot.prototype.updateSize.call(this),this.svg.attr("viewBox","0 0 "+this.internalWidth+" "+this.internalHeight)},e.ScatterPlotSVG.prototype.redrawSelectedPoints=function(){var e=this,t=this.getPlottablePoints(this.selection);t.length<this.selection.length?this.warningReadout.text(this.selection.length-t.length+" point(s) could not be plotted (because they contain NaN or undefined values)."):this.warningReadout.text("");var a=this.selectedPoints.selectAll("circle").data(t);a.enter().append("circle").attr("r","6").merge(a).attr("index",function(e){return e}).attr("cx",function(t){return e.x(e.db.data[t][e.xDimension])}).attr("cy",function(t){return e.y(e.db.data[t][e.yDimension])}).on("mouseenter",function(t){e.dispatch.call("mouseover",e,t,d3.event)}).on("mouseleave",function(){e.dispatch.call("mouseover",e,null,d3.event)}),a.exit().remove()},e.ScatterPlotSVG.prototype.redrawHighlightedPoints=function(){var e=this,t=this.highlightedPoints.selectAll("circle").data(this.getPlottablePoints(this.highlighted));t.enter().append("circle").attr("r","10").merge(t).attr("index",function(e){return e}).attr("cx",function(t){return e.x(e.db.data[t][e.xDimension])}).attr("cy",function(t){return e.y(e.db.data[t][e.yDimension])}),t.exit().remove()},e.ScatterPlotSVG.prototype.redrawOverlayPoints=function(){var e=this,t=this.overlayPoints.selectAll("circle").data(this.overlayData);t.enter().append("circle").attr("r","5").merge(t).attr("cx",function(t){return e.x(t.data[e.xDimension])}).attr("cy",function(t){return e.y(t.data[e.yDimension])}).attr("style",function(e){return e.style}),t.exit().remove()}}();